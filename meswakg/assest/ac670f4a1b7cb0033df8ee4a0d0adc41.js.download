(function($){var cache={idx_expanded:-1,sliceH:0,current:0,totalSlices:0},aux={selectSlice:function($el,$slices,$navNext,$navPrev,settings){return $.Deferred(function(dfd){var expanded=$el.data('expanded'),pos=$el.data('position'),itemHeight,othersHeight,$others=$slices.not($el);if(expanded){$el.data('expanded',!1);cache.idx_expanded=-1;itemHeight=cache.sliceH;othersHeight=cache.sliceH;$el.find('.va-content').hide();$el.find('.va-title').removeClass('htmegava-active');if(aux.canSlideUp($slices,settings))
$navPrev.fadeIn();else $navPrev.fadeOut();if(aux.canSlideDown($slices,settings))
$navNext.fadeIn();else $navNext.fadeOut()}else{$el.data('expanded',!0);cache.idx_expanded=$el.index();$others.data('expanded',!1);itemHeight=settings.expandedHeight;othersHeight=Math.ceil((settings.accordionH-settings.expandedHeight)/(settings.visibleSlices-1));if(cache.idx_expanded>0)
$navPrev.fadeIn();else $navPrev.fadeOut();if(cache.idx_expanded<cache.totalSlices-1)
$navNext.fadeIn();else $navNext.fadeOut()}
var animParam={height:itemHeight+'px',opacity:1,top:(pos-1)*othersHeight+'px'};$el.stop().animate(animParam,settings.animSpeed,settings.animEasing,function(){if(!expanded)
$el.find('.va-content').fadeIn(settings.contentAnimSpeed)}).find('.va-title').stop().animate({lineHeight:cache.sliceH+'px'},settings.animSpeed,settings.animEasing);if(!expanded){$el.find('.va-title').addClass('htmegava-active')}else{$el.find('.va-title').removeClass('htmegava-active')}
$others.each(function(i){var $other=$(this),posother=$other.data('position'),t;if(expanded)
t=(posother-1)*othersHeight;else{if(posother<pos)
t=(posother-1)*othersHeight;else t=((posother-2)*othersHeight)+settings.expandedHeight}
$other.stop().animate({top:t+'px',height:othersHeight+'px',opacity:(expanded)?1:settings.animOpacity},settings.animSpeed,settings.animEasing,dfd.resolve).find('.va-title').removeClass('htmegava-active').stop().animate({lineHeight:othersHeight+'px'},settings.animSpeed,settings.animEasing).end().find('.va-content').hide()})}).promise()},navigate:function(dir,$slices,$navNext,$navPrev,settings){if($slices.is(':animated'))
return!1;var $el;if(cache.idx_expanded!=-1&&!settings.savePositions){$el=$slices.eq(cache.idx_expanded);$.when(aux.selectSlice($el,$slices,$navNext,$navPrev,settings)).done(function(){setTimeout(function(){aux.slide(dir,$slices,$navNext,$navPrev,settings)},10)})}else{aux.slide(dir,$slices,$navNext,$navPrev,settings)}},slide:function(dir,$slices,$navNext,$navPrev,settings){if(cache.idx_expanded===-1||!settings.savePositions){if(dir===1&&cache.current+settings.visibleSlices>=cache.totalSlices)
return!1;else if(dir===-1&&cache.current===0)
return!1;if(dir===-1&&cache.current===1)
$navPrev.fadeOut();else $navPrev.fadeIn();if(dir===1&&cache.current+settings.visibleSlices===cache.totalSlices-1)
$navNext.fadeOut();else $navNext.fadeIn()}else{if(dir===1&&cache.idx_expanded===cache.totalSlices-1)
return!1;else if(dir===-1&&cache.idx_expanded===0)
return!1;if(dir===-1&&cache.idx_expanded===1)
$navPrev.fadeOut();else $navPrev.fadeIn();if(dir===1&&cache.idx_expanded===cache.totalSlices-2)
$navNext.fadeOut();else $navNext.fadeIn()}
var $currentSlice=$slices.eq(cache.idx_expanded),$nextSlice,t;(dir===1)?$nextSlice=$currentSlice.next():$nextSlice=$currentSlice.prev();if((dir===1&&!aux.canSlideDown($slices,settings))||(dir===-1&&!aux.canSlideUp($slices,settings))){aux.selectSlice($nextSlice,$slices,$navNext,$navPrev,settings);return!1}
if(dir===1){cache.current++;t='-='+cache.sliceH;pos_increment=-1}else{cache.current--;t='+='+cache.sliceH;pos_increment=1}
$slices.each(function(i){var $slice=$(this),pos=$slice.data('position');if(!settings.savePositions||cache.idx_expanded===-1)
$slice.stop().animate({top:t},settings.animSpeed,settings.animEasing);else{var itemHeight,othersHeight;if(i===$nextSlice.index()){$slice.data('expanded',!0);cache.idx_expanded=$slice.index();itemHeight=settings.expandedHeight;othersHeight=(settings.accordionH-settings.expandedHeight)/(settings.visibleSlices-1);$slice.stop().animate({height:itemHeight+'px',opacity:1,top:(dir===1)?(pos-2)*othersHeight+'px':pos*othersHeight+'px'},settings.animSpeed,settings.animEasing,function(){$slice.find('.va-content').fadeIn(settings.contentAnimSpeed)}).find('.va-title').stop().animate({lineHeight:cache.sliceH+'px'},settings.animSpeed,settings.animEasing)}else if($slice.data('expanded')){$slice.data('expanded',!1);othersHeight=(settings.accordionH-settings.expandedHeight)/(settings.visibleSlices-1);$slice.stop().animate({height:othersHeight+'px',opacity:settings.animOpacity,top:(dir===1)?'-='+othersHeight:'+='+settings.expandedHeight},settings.animSpeed,settings.animEasing).find('.va-title').stop().animate({lineHeight:othersHeight+'px'},settings.animSpeed,settings.animEasing).end().find('.va-content').hide()}else{$slice.data('expanded',!1);othersHeight=(settings.accordionH-settings.expandedHeight)/(settings.visibleSlices-1);$slice.stop().animate({top:(dir===1)?'-='+othersHeight:'+='+othersHeight},settings.animSpeed,settings.animEasing)}}
$slice.data().position+=pos_increment})},canSlideUp:function($slices,settings){var $first=$slices.eq(cache.current);if($first.index()!==0)
return!0},canSlideDown:function($slices,settings){var $last=$slices.eq(cache.current+settings.visibleSlices-1);if($last.index()!==cache.totalSlices-1)
return!0}},methods={init:function(options){if(this.length){var settings={accordionH:450,visibleSlices:3,expandedHeight:350,animSpeed:250,animEasing:'jswing',animOpacity:0.2,contentAnimSpeed:900,savePositions:!0};return this.each(function(){if(options){$.extend(settings,options)}
var $el=$(this),$slices=$el.find('div.single_accordion'),$navNext=$el.find('span.va-nav-next'),$navPrev=$el.find('span.va-nav-prev');cache.sliceH=Math.ceil(settings.accordionH/settings.visibleSlices);cache.totalSlices=$slices.length;if(settings.expandedHeight>settings.accordionH)
settings.expandedHeight=settings.accordionH;else if(settings.expandedHeight<=cache.sliceH)
settings.expandedHeight=cache.sliceH+50;$el.css({width:settings.accordionW+'px',height:settings.accordionH+'px'});if(settings.visibleSlices<cache.totalSlices)
$navNext.show();$slices.each(function(i){var $slice=$(this);$slice.css({top:i*cache.sliceH+'px',height:cache.sliceH+'px'}).data('position',(i+1))}).children('.va-title').css('line-height',cache.sliceH+'px');$slices.bind('click.vaccordion',function(e){if(settings.visibleSlices>1){var $el=$(this);aux.selectSlice($el,$slices,$navNext,$navPrev,settings)}});$navNext.bind('click.vaccordion',function(e){aux.navigate(1,$slices,$navNext,$navPrev,settings)});$navPrev.bind('click.vaccordion',function(e){aux.navigate(-1,$slices,$navNext,$navPrev,settings)});$el.bind('mousewheel.vaccordion',function(e,delta){if(delta>0){aux.navigate(-1,$slices,$navNext,$navPrev,settings)}else{aux.navigate(1,$slices,$navNext,$navPrev,settings)}
return!1})})}}};$.fn.vaccordion=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments)}else{$.error('Method '+method+' does not exist on jQuery.vaccordion')}}})(jQuery)
;